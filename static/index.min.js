function init(){showWelcomeLayer(),body=document.getElementById("gameBody")||document.body,body.style.height=window.innerHeight+"px",transform=void 0!==body.style.webkitTransform?"webkitTransform":void 0!==body.style.msTransform?"msTransform":"transform",transitionDuration=transform.replace(/ransform/g,"ransitionDuration"),GameTimeLayer=document.getElementById("GameTimeLayer"),GameLayer.push(document.getElementById("GameLayer1")),GameLayer[0].children=GameLayer[0].querySelectorAll("div"),GameLayer.push(document.getElementById("GameLayer2")),GameLayer[1].children=GameLayer[1].querySelectorAll("div"),GameLayerBG=document.getElementById("GameLayerBG"),null===GameLayerBG.ontouchstart?GameLayerBG.ontouchstart=gameTapEvent:GameLayerBG.onmousedown=gameTapEvent,gameInit();var e=cookie("username"),t=cookie("message");e&&(document.getElementById("username").value=e),t&&(document.getElementById("message").value=t),window.addEventListener("resize",refreshSize,!1);var a=document.getElementById("ready-btn");a.className="btn btn-primary btn-lg",a.onclick=function(){closeWelcomeLayer()}}function winOpen(){window.open(location.href+"?r="+Math.random(),"nWin","height=500,width=320,toolbar=no,menubar=no,scrollbars=no");var e=window.open("about:blank","_self");e.opener=null,e.close()}function refreshSize(){clearTimeout(refreshSizeTime),refreshSizeTime=setTimeout(_refreshSize,200)}function _refreshSize(){countBlockSize();for(var e=0;e<GameLayer.length;e++)for(var t=GameLayer[e],a=0;a<t.children.length;a++){var n=t.children[a],r=n.style;r.left=a%4*blockSize+"px",r.bottom=Math.floor(a/4)*blockSize+"px",r.width=blockSize+"px",r.height=blockSize+"px"}var o,i;GameLayer[0].y>GameLayer[1].y?(o=GameLayer[0],i=GameLayer[1]):(o=GameLayer[1],i=GameLayer[0]);var m=_gameBBListIndex%10*blockSize;o.y=m,o.style[transform]="translate3D(0,"+o.y+"px,0)",i.y=-blockSize*Math.floor(o.children.length/4)+m,i.style[transform]="translate3D(0,"+i.y+"px,0)"}function countBlockSize(){blockSize=body.offsetWidth/4,body.style.height=window.innerHeight+"px",GameLayerBG.style.height=window.innerHeight+"px",touchArea[0]=window.innerHeight-0*blockSize,touchArea[1]=window.innerHeight-3*blockSize}function gameInit(){createjs.Sound.registerSound({src:"./static/music/err.mp3",id:"err"}),createjs.Sound.registerSound({src:"./static/music/end.mp3",id:"end"}),createjs.Sound.registerSound({src:"./static/music/tap.mp3",id:"tap"}),gameRestart()}function gameRestart(){_gameBBList=[],_gameBBListIndex=0,_gameScore=0,_gameOver=!1,_gameStart=!1,_gameTimeNum=20,GameTimeLayer.innerHTML=creatTimeText(_gameTimeNum),countBlockSize(),refreshGameLayer(GameLayer[0]),refreshGameLayer(GameLayer[1],1)}function gameStart(){_date1=new Date,_gameStart=!0,_gameTime=setInterval(gameTime,1e3)}function gameOver(){_gameOver=!0,clearInterval(_gameTime),setTimeout(function(){GameLayerBG.className="",showGameScoreLayer()},1500)}function encrypt(e){var t=new JSEncrypt;t.setPublicKey("MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDTzGwX6FVKc7rDiyF3H+jKpBlRCV4jOiJ4JR33qZPVXx8ahW6brdBF9H1vdHBAyO6AeYBumKIyunXP9xzvs1qJdRNhNoVwHCwGDu7TA+U4M7G9FArDG0Y6k4LbS0Ks9zeRBMiWkW53yQlPshhtOxXCuZZOMLqk1vEvTCODYYqX5QIDAQAB");var a=t.encrypt(e);return a}function SubmitResults(){var e="ÂÖ∂‰ªñÊìç‰ΩúÁ≥ªÁªü",t="ÂºÇ‰∏ñÁïå";if(document.getElementById("username").value){-1!=navigator.appVersion.indexOf("Win")&&(e="Windows"),-1!=navigator.appVersion.indexOf("Mac")&&(e="Macintosh"),-1!=navigator.appVersion.indexOf("Linux")&&(e="Linux"),-1!=navigator.appVersion.indexOf("Android")&&(e="Android"),-1!=navigator.appVersion.indexOf("like Mac")&&(e="iOS"),returnCitySN.cname&&(t=returnCitySN.cname);var a=new XMLHttpRequest;a.open("POST","./SubmitResults.php",!0),a.setRequestHeader("Content-type","application/json");var n=document.getElementById("username").value,r=document.getElementById("message").value,o="|_|";a.send(encrypt(_gameScore+o+n+o+tj+o+e+o+t+o+r))}}function gameTime(){_gameTimeNum--,_gameTimeNum<=0?(GameTimeLayer.innerHTML="&nbsp;&nbsp;&nbsp;&nbsp;Êó∂Èó¥Âà∞ÔºÅ",gameOver(),GameLayerBG.className+=" flash",createjs.Sound.play("end")):GameTimeLayer.innerHTML=creatTimeText(_gameTimeNum)}function creatTimeText(e){return"&nbsp;TIME:"+e}function refreshGameLayer(e,t,a){for(var n=Math.floor(1e3*Math.random())%4+(t?0:4),r=0;r<e.children.length;r++){var o=e.children[r],i=o.style;i.left=r%4*blockSize+"px",i.bottom=Math.floor(r/4)*blockSize+"px",i.width=blockSize+"px",i.height=blockSize+"px",o.className=o.className.replace(_clearttClsReg,""),n==r?(_gameBBList.push({cell:n%4,id:o.id}),o.className+=" t"+(Math.floor(1e3*Math.random())%5+1),o.notEmpty=!0,n=4*(Math.floor(r/4)+1)+Math.floor(1e3*Math.random())%4):o.notEmpty=!1}t?(e.style.webkitTransitionDuration="0ms",e.style.display="none",e.y=-blockSize*(Math.floor(e.children.length/4)+(a||0))*t,setTimeout(function(){e.style[transform]="translate3D(0,"+e.y+"px,0)",setTimeout(function(){e.style.display="block"},100)},200)):(e.y=0,e.style[transform]="translate3D(0,"+e.y+"px,0)"),e.style[transitionDuration]="150ms"}function gameLayerMoveNextRow(){for(var e=0;e<GameLayer.length;e++){var t=GameLayer[e];t.y+=blockSize,t.y>blockSize*Math.floor(t.children.length/4)?refreshGameLayer(t,1,-1):t.style[transform]="translate3D(0,"+t.y+"px,0)"}}function gameTapEvent(e){if(_gameOver)return!1;var t=e.target,a=e.clientY||e.targetTouches[0].clientY,n=(e.clientX||e.targetTouches[0].clientX)-body.offsetLeft,r=_gameBBList[_gameBBListIndex];return!(a>touchArea[0]||a<touchArea[1])&&(r.id==t.id&&t.notEmpty||0==r.cell&&n<blockSize||1==r.cell&&n>blockSize&&n<2*blockSize||2==r.cell&&n>2*blockSize&&n<3*blockSize||3==r.cell&&n>3*blockSize?(_gameStart||gameStart(),createjs.Sound.play("tap"),t=document.getElementById(r.id),t.className=t.className.replace(_ttreg," tt$1"),_gameBBListIndex++,_gameScore++,gameLayerMoveNextRow()):_gameStart&&!t.notEmpty&&(createjs.Sound.play("err"),gameOver(),t.className+=" bad"),!1)}function createGameLayer(){for(var e='<div id="GameLayerBG">',t=1;t<=2;t++){var a="GameLayer"+t;e+='<div id="'+a+'" class="GameLayer">';for(var n=0;n<10;n++)for(var r=0;r<4;r++)e+='<div id="'+a+"-"+(r+4*n)+'" num="'+(r+4*n)+'" class="block'+(r?" bl":"")+'"></div>';e+="</div>"}return e+="</div>",e+='<div id="GameTimeLayer"></div>',e}function closeWelcomeLayer(){var e=document.getElementById("welcome");e.style.display="none"}function showWelcomeLayer(){var e=document.getElementById("welcome");e.style.display="block"}function showGameScoreLayer(){var e=document.getElementById("GameScoreLayer"),t=document.getElementById(_gameBBList[_gameBBListIndex-1].id).className.match(_ttreg)[1];e.className=e.className.replace(/bgc\d/,"bgc"+t),document.getElementById("GameScoreLayer-text").innerHTML=shareText(_gameScore);var a="ÂæóÂàÜ&nbsp;&nbsp;";a+=deviation_time<23e3?_gameScore:"<span style='color:red;'>"+_gameScore+"</span>",document.getElementById("GameScoreLayer-score").innerHTML=a;var n=cookie("bast-score");deviation_time<23e3&&(!n||_gameScore>n)&&(n=_gameScore,cookie("bast-score",n,100)),document.getElementById("GameScoreLayer-bast").innerHTML="ÊúÄ‰Ω≥&nbsp;&nbsp;"+n,e.style.display="block"}function hideGameScoreLayer(){var e=document.getElementById("GameScoreLayer");e.style.display="none"}function replayBtn(){gameRestart(),hideGameScoreLayer()}function backBtn(){gameRestart(),hideGameScoreLayer(),showWelcomeLayer()}function shareText(e){var t=new Date;return deviation_time=t.getTime()-_date1.getTime(),deviation_time>23e3?"ÂÄíËÆ°Êó∂Â§ö‰∫Ü"+(deviation_time/1e3-20).toFixed(2)+"s":(SubmitResults(),e<=30?"Ëøô‰πàÊÖ¢ËøòÊÉ≥ÊäìÊùæÈº†üêøÔ∏èÔºü":e<=100?"ÂàÜÊï∞ËøòÂú®‰∏§‰ΩçÊï∞Âïä~ÊúâÁæ§ÂèãÁ¨¨‰∏ÄÊ¨°ÊâìÂ∞±ÊòØ‰∏â‰ΩçÊï∞üòí":e<=150?"Ë∂Öüëèüëèüëè":e<=199?"ÊÇ®":"‰∫∫Ôºü")}function toStr(e){return"object"==typeof e?JSON.stringify(e):e}function cookie(name,value,time){if(name){if(value){if(time){var date=new Date;date.setTime(date.getTime()+864e5*time),time=date.toGMTString()}return document.cookie=name+"="+escape(toStr(value))+(time?"; expires="+time+(arguments[3]?"; domain="+arguments[3]+(arguments[4]?"; path="+arguments[4]+(arguments[5]?"; secure":""):""):""):""),!0}return value=document.cookie.match("(?:^|;)\\s*"+name.replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")+"=([^;]*)"),value=!(!value||"string"!=typeof value[1])&&unescape(value[1]),(/^(\{|\[).+\}|\]$/.test(value)||/^[0-9]+$/g.test(value))&&eval("value="+value),value}var data={};value=document.cookie.replace(/\s/g,"").split(";");for(var i=0;value.length>i;i++)name=value[i].split("="),name[1]&&(data[name[0]]=unescape(name[1]));return data}function show_btn(){document.getElementById("btn_group").style.display="block",document.getElementById("setting").style.display="none"}function show_setting(){document.getElementById("btn_group").style.display="none",document.getElementById("setting").style.display="block"}function save_cookie(){cookie("username",document.getElementById("username").value,100),cookie("message",document.getElementById("message").value,100)}function isnull(e){var t=e.replace(/(^\s*)|(\s*$)/g,"");return""==t||null==t||null==t}function goRank(){var e=document.getElementById("username").value,t="./rank.php";isnull(e)||(t+="?name="+e),window.location.href=t}var isDesktop=!navigator.userAgent.match(/(ipad|iphone|ipod|android|windows phone)/i),fontunit=isDesktop?20:(window.innerWidth>window.innerHeight?window.innerHeight:window.innerWidth)/320*10;document.write('<style type="text/css">html,body {font-size:'+(fontunit<30?fontunit:"30")+"px;}"+(isDesktop?"#welcome,#GameTimeLayer,#GameLayerBG,#GameScoreLayer.SHADE{position: absolute;}":"#welcome,#GameTimeLayer,#GameLayerBG,#GameScoreLayer.SHADE{position:fixed;}@media screen and (orientation:landscape) {#landscape {display: box; display: -webkit-box; display: -moz-box; display: -ms-flexbox;}}")+"</style>"),isDesktop&&document.write('<div id="gameBody">');var body,blockSize,GameLayer=[],GameLayerBG,touchArea=[],GameTimeLayer,transform,transitionDuration,refreshSizeTime,_gameBBList=[],_gameBBListIndex=0,_gameOver=!1,_gameStart=!1,_gameTime,_gameTimeNum,_gameScore,_ttreg=/ t{1,2}(\d+)/,_clearttClsReg=/ t{1,2}\d+| bad/;document.write(createGameLayer()),console.log("‰∏ç‰øÆÊîπÔºåÂ•ΩÂòõÔºü‰π±‰º†ÂèàÊúâ‰ªÄ‰πàÁî®Âë¢Ôºü(Àâ‚ñΩÀâÔºõ)..."),document.onkeydown=function(e){if(123==e.keyCode)return!1};